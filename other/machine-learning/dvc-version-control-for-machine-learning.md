# üß§ DVC Version Control for Machine Learning

{% hint style="info" %}
‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Version Control ‡∏°‡∏µ‡∏°‡∏≤‡∏ô‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏•‡πà‡∏≤ Programmer ‡πÅ‡∏•‡∏∞ Developer ‡πÇ‡∏î‡∏¢‡πÉ‡∏ô‡∏™‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏≤‡∏ô Data Science ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Machine Learning ‡∏Å‡πá‡∏°‡∏µ Version Control ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ DVC ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢ ‡πÜ ‡∏Å‡∏±‡∏ö Git
{% endhint %}

## **Workflow**

{% hint style="success" %}
‡πÇ‡∏î‡∏¢‡∏õ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Model ‡∏Ç‡∏≠‡∏á Machine Learning ‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢ 3 ‡∏™‡πà‡∏ß‡∏ô ‡∏Ñ‡∏∑‡∏≠ Code, Data ‡πÅ‡∏•‡∏∞ Configuration ‡∏ô‡∏≥‡∏°‡∏≤ Train ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ Model ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Reproduce
{% endhint %}

![](../../.gitbook/assets/dvc-00.png)

‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á DVC ‡∏à‡∏∞‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢ ‡πÜ ‡∏Å‡∏±‡∏ö Git ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÅ‡∏ö‡πà‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 2 ‡πÅ‡∏ö‡∏ö ‡∏Ñ‡∏∑‡∏≠ ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Code ‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Remote Code Storage ‡∏Ç‡∏≠‡∏á Git Server ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Model ‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Remote Data Storage ‡πÄ‡∏ä‡πà‡∏ô S3, GS, Azure, SSH ‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á

![](../../.gitbook/assets/dvc.gif)

## **Download**

* [DVC](https://dvc.org/)

## **Get Started**

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á DVC

![](../../.gitbook/assets/dvc-01.png)

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Code ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Git Repository

{% code title="C:\dvc>" %}
```
git init
```
{% endcode %}

{% code title="C:\dvc>" %}
```
wget https://dvc.org/s3/examples/so/code.zip
```
{% endcode %}

{% code title="C:\dvc>" %}
```
unzip code.zip && rm -f code.zip
```
{% endcode %}

{% code title="C:\dvc>" %}
```
git add code/
```
{% endcode %}

{% code title="" %}
```
git commit -m "download and initialize code"
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Virtual Environment

{% code title="C:\dvc>" %}
```
mkvirtualenv venv
```
{% endcode %}

{% code title="C:\dvc>" %}
```
workon venv
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Package ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå requirements.txt

{% code title="(venv) C:\nlp>" %}
```
pip install -r code/requirements.txt
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á DVC Repository

{% code title="(venv) C:\nlp>" %}
```
dvc init
```
{% endcode %}

{% code title="(venv) C:\nlp>" %}
```
git commit -m "initialize DVC"
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Dataset ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Add ‡πÉ‡∏ô DVC ‡∏î‡πâ‡∏ß‡∏¢

{% code title="" %}
```
mkdir data
```
{% endcode %}

{% code title="(venv) C:\nlp>" %}
```
wget -P data https://dvc.org/s3/examples/so/Posts.xml.zip
```
{% endcode %}

{% code title="(venv) C:\nlp>" %}
```
dvc add data/Posts.xml.zip
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Commit ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Git Repository

{% code title="(venv) C:\nlp>" %}
```
git add data/Posts.xml.zip.dvc data/.gitignore
```
{% endcode %}

{% code title="(venv) C:\nlp>" %}
```
git commit -m "add dataset"
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Run ‡πÉ‡∏ô DVC ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ Stage

{% code title="(venv) C:\nlp>" %}
```
dvc run -d data/Posts.xml.zip ^
        -o data/Posts.xml ^
        -f extract.dvc ^
        unzip data/Posts.xml.zip -d data
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Convert ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å XML ‡πÄ‡∏õ‡πá‡∏ô TSV ‡πÉ‡∏ô DVC ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ Feature Extraction ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô

{% code title="(venv) C:\nlp>" %}
```
dvc run -d code/xml_to_tsv.py -d data/Posts.xml ^
          -o data/Posts.tsv ^
          -f prepare.dvc ^
          python code/xml_to_tsv.py data/Posts.xml data/Posts.tsv
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Split Dataset ‡πÉ‡∏ô DVC ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Training ‡πÅ‡∏•‡∏∞ Test ‡πÇ‡∏î‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ Test Dataset ‡∏°‡∏µ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0.2 ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ Seed ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Random ‡πÄ‡∏õ‡πá‡∏ô 20170426

{% code title="(venv) C:\nlp>" %}
```
dvc run -d code/split_train_test.py -d data/Posts.tsv ^
          -o data/Posts-train.tsv -o data/Posts-test.tsv ^
          -f split.dvc ^
          python code/split_train_test.py data/Posts.tsv 0.2 20170426 ^
          data/Posts-train.tsv data/Posts-test.tsv
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Extract Feature and Label ‡πÉ‡∏ô DVC ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏ü‡∏•‡πå Pickle

{% code title="(venv) C:\nlp>" %}
```
dvc run -d code/featurization.py -d data/Posts-train.tsv -d data/Posts-test.tsv ^
        -o data/matrix-train.pkl -o data/matrix-test.pkl ^
        -f featurize.dvc ^
        python code/featurization.py data/Posts-train.tsv data/Posts-test.tsv ^
        data/matrix-train.pkl data/matrix-test.pkl
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Train Model ‡∏Å‡∏±‡∏ö Training Dataset ‡πÉ‡∏ô DVC

{% code title="(venv) C:\nlp>" %}
```
dvc run -d code/train_model.py -d data/matrix-train.pkl ^
        -o data/model.pkl ^
        -f train.dvc ^
python code/train_model.py data/matrix-train.pkl 20170426 data/model.pkl
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Evaluate Model ‡∏Å‡∏±‡∏ö Test Dataset ‡πÉ‡∏ô DVC

{% code title="" %}
```
dvc run -d code/evaluate.py -d data/model.pkl -d data/matrix-test.pkl ^
          -M auc.metric ^
          -f evaluate.dvc ^
python code/evaluate.py data/model.pkl data/matrix-test.pkl auc.metric
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Accuracy ‡πÉ‡∏ô DVC ‡∏î‡πâ‡∏ß‡∏¢ Metric

{% code title="(venv) C:\nlp>" %}
```
dvc metrics show
```
{% endcode %}

```
auc.metric: AUC: 0.587951
```

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Commit ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Git Repository

{% code title="(venv) C:\nlp>" %}
```
git add *.dvc auc.metric
```
{% endcode %}

{% code title="(venv) C:\nlp>" %}
```
git commit -am "create pipeline"
```
{% endcode %}

* &#x20;‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå code/featurization.py ( ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 72-73 )

{% code title="(venv) C:\nlp>" %}
```
notepad code/featurization.py
```
{% endcode %}

```
bag_of_words = CountVectorizer(stop_words='english',
                               max_features=5000,
                               ngram_range=(1, 2))
```

* &#x20;‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Reproduce ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å Stage ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö Auto ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå

{% code title="(venv) C:\nlp>" %}
```
dvc repro evaluate.dvc
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Accuracy ‡πÉ‡∏ô DVC ‡∏î‡πâ‡∏ß‡∏¢ Metric ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å Branch

{% code title="(venv) C:\nlp>" %}
```
dvc metrics show -a
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Commit ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Git Repository

{% code title="(venv) C:\nlp>" %}
```
git add evaluate.dvc auc.metric
```
{% endcode %}

{% code title="(venv) C:\nlp>" %}
```
git commit -m "add evaluation step to the pipeline
```
{% endcode %}

* &#x20;‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Tag ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö Checkpoint ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Compare

{% code title="(venv) C:\nlp>" %}
```
git tag -a "baseline-experiment" -m "baseline"
```
{% endcode %}

* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Show Pipeline ‡πÅ‡∏ö‡∏ö ASCII

{% code title="(venv) C:\nlp>" %}
```
dvc pipeline show --ascii train.dvc
```
{% endcode %}

{% code title="(venv) C:\nlp>" %}
```
dvc pipeline show --ascii train.dvc --commands
```
{% endcode %}

{% code title="(venv) C:\nlp>" %}
```
dvc pipeline show --ascii train.dvc --outs
```
{% endcode %}

* ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á Visualize Pipeline ‡πÉ‡∏ô‡πÅ‡∏ö‡∏ö ASCII

![](../../.gitbook/assets/dvc-02.png)

**‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°** : [https://bit.ly/2FOQM5v](https://bit.ly/2FOQM5v)
